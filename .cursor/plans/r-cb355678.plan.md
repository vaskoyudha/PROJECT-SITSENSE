---
name: Untitled Plan
overview: ""
todos:
  - id: 5d208c60-6449-4527-b1ac-78d87586793d
    content: Buat modul `time-scale.js` global (SitSenseTime) dan integrasikan ke `index.html`/`settings.html`, dengan API setScale/getScale/toScaledMs/fromMinutes.
    status: pending
  - id: 87c2de01-0994-4479-9a17-06413d882eb5
    content: Modifikasi `alerts.js` dan `settings.js` agar soft/hard timer dan repeat menggunakan time scale dari SitSenseTime.
    status: pending
  - id: 34bcef78-d682-46a4-b79b-179a6e951092
    content: Modifikasi `session-manager.js` agar eskalasi postur (audioEscalation, escalationInterval, aiThresholdStreak) mengacu pada time scale.
    status: pending
  - id: 3246258b-eff6-48e5-8e62-d923612c0df0
    content: Tambahkan panel Admin/Developer di Settings (settings.html & settings.js) dengan slider timeScale, binding ke DEFAULTS.debug.timeScale dan SitSenseTime.setScale, serta logika menampilkan panel hanya untuk mode admin (query param/localStorage).
    status: pending
---

## Rencana Mode Admin vs Mode User SitSense

### 1. Tujuan Fitur

- **Memisahkan hak akses** antara pengguna biasa dan admin/pengembang.
- **Mempermudah testing**: admin bisa mengatur *kecepatan waktu* (time scale) sehingga semua ambang 2/5/10/30/60 menit bisa diuji dalam hitungan detik.
- **Menjaga keamanan & kenyamanan**: user biasa tetap memakai konfigurasi aman (tanpa time scale ekstrem dan tanpa mengubah threshold dasar).

### 2. Konsep Peran & Mode

- **Role dasar** (tanpa sistem auth yang rumit dulu):
- `mode = 'user'` (default) → semua ambang waktu berjalan wajar (real time).
- `mode = 'admin'` → bisa mengaktifkan "Time Scale" untuk mempercepat simulasi.
- **Cara memilih mode**:
- Tahap awal: pilih mode via **query param** (`?admin=1`) atau **localStorage flag** (`sitsense_mode = 'admin'`).
- Setelah itu, di UI (Settings) akan muncul **panel tambahan** khusus admin.

### 3. Time Scale Engine (inti perubahan)

- Tambahkan modul ringan `time-scale.js` yang mengekspor global `SitSenseTime`:
- Properti: `scale` (default `1.0`), `setScale(factor)`, `getScale()`.
- Fungsi helper:
  - `toScaledMs(ms) = ms / scale`  (untuk mengubah interval / threshold agar *lebih cepat* saat scale > 1).
  - `fromMinutes(min) = min * 60 * 1000 / scale`  (konversi menit → ms yang sudah di-scale).
- Semua modul yang pakai waktu akan secara bertahap diarahkan ke helper ini:
- `alerts.js` (soft/hard timer)
- `session-manager.js` (escalationInterval, aiThresholdStreak, audioEscalation)
- (Opsional) `mock-posture.js` interval simulasi.

### 4. Integrasi Time Scale ke Timer Duduk (`alerts.js`)

- Di tempat timer menghitung elapsed dan cek threshold:
- Saat `setThresholds` dipanggil dari Settings, simpan juga nilai "mentah" dalam menit, tetapi ketika dikonversi ke detik:
  - `soft = baseSoftMin * 60 / SitSenseTime.getScale()`
  - `hard = baseHardMin * 60 / SitSenseTime.getScale()`
  - `repeatSoftSec`, `repeatHardSec` juga dibagi `scale`.
- Dengan begitu, jika admin set `scale = 10`, maka:
- 30 menit → terasa seperti 3 menit.
- 60 menit → terasa seperti 6 menit.
- User biasa (scale = 1) tidak terpengaruh dan tetap memakai menit real.

### 5. Integrasi Time Scale ke Eskalasi Postur (`session-manager.js`)

- Field yang terpengaruh:
- `config.tickInterval` (interval rekam tick) – boleh tetap 10 detik real, atau ikut di-scale untuk test ekstrem.
- `config.escalationInterval` (cooldown antar warning) – gunakan `fromMinutes()`.
- `config.audioEscalation` dan `config.aiThresholdStreak` dalam **menit logis**.
- Implementasi:
- Simpan ambang dalam menit (2/5/10/15), tapi ketika menghitung streak buruk (dalam **ms/detik real**), bandingkan dengan:
  - `minMs = targetMinutes * 60 * 1000 / SitSenseTime.getScale()`.
- Jadi pada `scale = 10`, 2 menit buruk menjadi 12 detik real.

### 6. UI Admin Panel & Toggle Time Scale (Settings)

- Di `settings.html` dan `settings.js` tambahkan panel **Admin / Developer** (hanya muncul jika `mode === 'admin'`):
- Slider / input number `timeScale` dengan nilai contoh:
  - 1x (normal)
  - 5x
  - 10x
  - 30x (untuk demo cepat)
- Label: "Percepat waktu untuk keperluan testing (hanya admin)."
- Di `settings.js`:
- Tambahkan field baru di `DEFAULTS`, mis. `debug: { timeScale: 1 }`.
- `applySettings` memanggil `SitSenseTime.setScale(s.debug.timeScale || 1)`.
- `updateUIFromSettings` mengisi nilai slider/admin field.
- Bind event perubahan slider ke `applyNested('debug','timeScale', ...)` sehingga perubahan langsung diterapkan.

### 7. Proteksi Mode Admin

- Tahap awal (tanpa backend auth):
- Hanya tampilkan panel Admin jika salah satu kondisi terpenuhi:
  - URL mengandung `?admin=1`, atau
  - `localStorage.sitsense_mode === 'admin'`.
- Bisa dibuat tombol kecil "Masuk mode admin" di Settings yang:
  - Meminta konfirmasi (prompt password sederhana atau sekadar konfirmasi), lalu menyimpan flag ke localStorage.
- Di masa depan dapat diganti dengan sistem login role-based penuh; desain time-scale tetap bisa dipakai karena independen.

### 8. Dampak ke Testing & Dokumentasi

- **Testing**:
- Admin dapat menyetel `timeScale = 10` lalu:
  - Jalankan sesi dengan `mockPosture=bad` dan lihat Audio Coach/alerts muncul dalam detik.
- Pastikan saat `timeScale` berubah di tengah sesi, threshold berikutnya memakai nilai baru (jelaskan perilakunya di komentar).
- **Dokumentasi**:
- Tambahkan catatan di README/Docs: penjelasan `timeScale`, cara masuk mode admin, dan peringatan agar **tidak digunakan** pada deployment produksi kecuali oleh admin.

### 9. Urutan Implementasi

1. Buat modul `time-scale.js` dan daftarkan di `index.html` & `settings.html` sebelum modul lain yang pakai waktu.
2. Refactor `alerts.js` untuk membaca time scale ketika mengatur threshold.
3. Refactor `session-manager.js` untuk membaca time scale saat menghitung streak buruk dan cooldown.
4. Tambah panel Admin di Settings (`settings.html` + `settings.js`) untuk slider time scale + penyimpanan di `DEFAULTS.debug`.
5. Tambah mekanisme sederhana penentuan `mode` (query param + localStorage) dan hide panel admin bila bukan admin.
6. Uji kombinasi: mode user (scale=1), mode admin (scale>1), dengan dan tanpa sensor (menggunakan `mockPosture`).