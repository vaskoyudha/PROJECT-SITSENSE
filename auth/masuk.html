<!doctype html>
<html lang="id" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SitSense — Masuk</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
    <script src="../assets/js/firebase-config.js"></script>
    <link rel="stylesheet" href="../assets/css/styles.css" />
    <link rel="stylesheet" href="../assets/css/theme.css" />
    <style>
      html, body { overflow-x: hidden; max-width: 100vw; }
      .auth-decor { position: fixed; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
      .decor-blob { position: absolute; border-radius: 9999px; filter: blur(80px); opacity: .22; }
      .decor-cyan { background: radial-gradient(closest-side, rgba(6,182,212,.6), transparent); }
      .decor-emerald { background: radial-gradient(closest-side, rgba(16,185,129,.6), transparent); }
      @keyframes floatAuth {
        0%,100% { transform: translateY(0) translateX(0) rotate(0deg); }
        33% { transform: translateY(-14px) translateX(10px) rotate(4deg); }
        66% { transform: translateY(10px) translateX(-8px) rotate(-3deg); }
      }
      .floating { animation: floatAuth 9s ease-in-out infinite; }
      .floating.slow { animation-duration: 12s; }
      .floating.fast { animation-duration: 6s; }
      .auth-gradient { 
        position: fixed; inset: 0; z-index: 0; opacity: .55; 
        background: linear-gradient(
          120deg,
          #0b1220 0%,
          #0b2433 15%,
          rgba(8,145,178,0.28) 35%,
          rgba(139,92,246,0.28) 55%,
          rgba(16,185,129,0.28) 75%,
          #0b1220 100%
        );
        background-size: 300% 300%;
        animation: gradientShift 16s ease-in-out infinite, hueShift 20s linear infinite;
      }
      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      @keyframes hueShift {
        0% { filter: hue-rotate(0deg); }
        100% { filter: hue-rotate(30deg); }
      }
    </style>
  </head>
  <body class="min-h-screen text-slate-100 bg-[#0b1220] flex items-center justify-center p-4">
    <div class="auth-gradient"></div>
    <div class="auth-decor">
      <div class="decor-blob decor-cyan floating" style="width:420px;height:420px;left:-140px;top:-100px;"></div>
      <div class="decor-blob decor-emerald floating slow" style="width:520px;height:520px;right:-160px;bottom:-140px;"></div>
      <div class="floating fast" style="position:absolute; top:12%; right:10%;">
        <div class="rounded-2xl glassy-card card-border px-3 py-2 opacity-70">
          <i data-lucide="lock" class="h-4 w-4 text-cyan-300"></i>
        </div>
      </div>
      <div class="floating" style="position:absolute; bottom:18%; left:8%;">
        <div class="rounded-full glassy-card card-border px-3 py-2 opacity-70">
          <i data-lucide="user" class="h-4 w-4 text-emerald-300"></i>
        </div>
      </div>
    </div>
    <div class="w-[min(460px,92vw)] glassy-card card-border rounded-2xl p-6 md:p-8">
      <div class="flex items-center gap-3 mb-4">
        <img data-image-base="logo-sitsense" alt="SitSense" class="h-8 w-auto" />
        <h1 class="text-xl font-semibold tracking-tight">Masuk</h1>
      </div>
      <p class="text-slate-400 text-sm mb-6">Akses dashboard SitSense dengan akun Anda.</p>
      <form id="loginForm" class="space-y-4">
        <div>
          <label class="label"><span class="label-text text-slate-300">Email</span></label>
          <input id="email" type="email" class="input input-bordered w-full bg-white/5 border-white/10" placeholder="email@example.com" required />
        </div>
        <div>
          <label class="label"><span class="label-text text-slate-300">Password</span></label>
          <input id="password" type="password" class="input input-bordered w-full bg-white/5 border-white/10" placeholder="••••••••" required />
        </div>
        <div id="formMsg" class="text-sm text-rose-300 min-h-5"></div>
        <button type="submit" class="btn btn-gradient-outline w-full normal-case">Masuk</button>
        <div class="text-center text-xs text-slate-500 uppercase tracking-wide">atau</div>
        <button type="button" id="btnGoogleLogin" class="btn btn-outline btn-sm w-full normal-case gap-2 border-white/20 text-slate-200 hover:text-white">
          <svg class="h-4 w-4" viewBox="0 0 533.5 544.3" aria-hidden="true" focusable="false">
            <path fill="#4285f4" d="M533.5 278.4c0-18.5-1.5-37.1-4.7-55.2H272.1v104.7h147.5c-6.1 33.3-25.6 61.6-54.5 80.4v66h88.2c51.8-47.7 80.2-118.1 80.2-195.9z"/>
            <path fill="#34a853" d="M272.1 544.3c73.7 0 135.6-24.3 180.8-65.9l-88.2-66c-24.4 16.3-55.8 25.8-92.6 25.8-71 0-131.1-47.9-152.7-112.2H27.7v70.4c45.3 90.1 138.3 147.9 244.4 147.9z"/>
            <path fill="#fbbc04" d="M119.4 326c-10.3-30.3-10.3-62.9 0-93.2V162.4H27.7c-40.9 81.4-40.9 177.8 0 259.2z"/>
            <path fill="#ea4335" d="M272.1 107.7c39.9-.6 78.3 14.6 107.6 42.8l80.3-80.3C407.3 24.2 341.9-.4 272.1 0 166 0 73 57.8 27.7 147.9l91.7 70.4c21.6-64.3 81.7-110.6 152.7-110.6z"/>
          </svg>
          Masuk dengan Google
        </button>
      </form>
      <div class="mt-4 text-sm text-slate-400">
        Belum punya akun? <a href="./daftar.html" class="text-cyan-300 hover:text-cyan-200">Daftar</a>
      </div>
      <div class="mt-6">
        <a href="../home.html" class="btn btn-ghost btn-sm normal-case">Kembali ke Beranda</a>
      </div>
    </div>
    <script src="../assets/js/image-loader.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        if (window.lucide) window.lucide.createIcons();
        const form = document.getElementById('loginForm');
        const msg = document.getElementById('formMsg');
        const params = new URLSearchParams(location.search);
        const next = params.get('next') || '../index.html?launched=true';
        const submitBtn = form.querySelector('button[type="submit"]');
        const defaultBtnText = submitBtn ? submitBtn.textContent : '';

        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          msg.textContent = '';
          const email = document.getElementById('email').value.trim();
          const password = document.getElementById('password').value;
          if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.textContent = 'Memproses...';
          }
          try {
            const res = await window.SitSenseAuth.login({ email, password });
            if (!res.ok) {
              msg.textContent = res.message || 'Gagal masuk';
              return;
            }
            window.location.href = next;
          } finally {
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.textContent = defaultBtnText;
            }
          }
        });

        const googleBtn = document.getElementById('btnGoogleLogin');
        if (googleBtn) {
          const originalContent = googleBtn.innerHTML;
          googleBtn.addEventListener('click', async function() {
            msg.textContent = '';
            googleBtn.disabled = true;
            googleBtn.innerHTML = '<span class="loading loading-spinner loading-sm"></span> Menghubungkan...';
            try {
              const res = await window.SitSenseAuth.loginWithGoogle();
              if (!res.ok && !res.pendingRedirect) {
                msg.textContent = res.message || 'Gagal masuk dengan Google';
                return;
              }
              if (!res.pendingRedirect) {
                window.location.href = next;
              }
            } finally {
              googleBtn.disabled = false;
              googleBtn.innerHTML = originalContent;
            }
          });
        }
      });
    </script>
  </body>
</html>
